@model GestorAlquilerVehiculos.Models.Reserva
@{
    ViewData["Title"] = "Reservar Vehículo";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var vehiculosInfo = ViewData["VehiculosInfo"] as Dictionary<int, decimal>;
    var clienteCorreo = ViewBag.CorreoElectronico as string;
}

<h2 class="text-center mb-4">Reservar Vehículo</h2>

<div class="container">
    <form asp-action="Create" method="post" class="p-4 shadow rounded bg-white">

        <!-- Correo del cliente (readonly) -->
        <div class="form-group">
            <label>Correo del Cliente</label>
            <input type="text" class="form-control" name="CorreoCliente" value="@clienteCorreo" readonly />
        </div>

        <!-- ClienteReservaID oculto -->
        <input type="hidden" asp-for="ClienteReservaID" />

        <!-- Vehículo -->
        <div class="form-group">
            <label asp-for="VehiculoID">Vehículo</label>
            <select asp-for="VehiculoID" class="form-control" asp-items="ViewBag.VehiculoID" id="vehiculoSelect">
                <option value="">-- Selecciona un vehículo --</option>
            </select>
            <span asp-validation-for="VehiculoID" class="text-danger"></span>
        </div>

        <!-- Costo Total -->
        <div class="form-group">
            <label asp-for="CostoTotal">Costo</label>
            <input asp-for="CostoTotal" class="form-control" id="CostoTotal" readonly />
            <span asp-validation-for="CostoTotal" class="text-danger"></span>
        </div>

        <!-- Estado y Fechas ocultas -->
        <input type="hidden" asp-for="Estado" value="Pendiente" />
        <input type="hidden" asp-for="FechaInicio" value="@DateTime.Now.ToString("yyyy-MM-dd")" />
        <input type="hidden" asp-for="FechaFin" value="@DateTime.Now.ToString("yyyy-MM-dd")" />
        <input type="hidden" asp-for="FechaRegistro" value="@DateTime.Now.ToString("yyyy-MM-ddTHH:mm:ss")" />

        <!-- Botones -->
        <div class="form-group text-center mt-4">
            <button type="submit" class="btn btn-primary px-4">Reservar</button>
            <a asp-action="Index" class="btn btn-secondary px-4">Cancelar</a>
        </div>
    </form>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        const preciosVehiculos = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(ViewData["VehiculosInfo"]));

        document.getElementById("vehiculoSelect").addEventListener("change", function () {
            const selected = this.value;
            const precio = preciosVehiculos[selected] || "";
            document.getElementById("CostoTotal").value = precio;
        });
    </script>
}